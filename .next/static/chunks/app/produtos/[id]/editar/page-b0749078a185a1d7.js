(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1737],{9458:(e,t,a)=>{"use strict";a.d(t,{HW:()=>i,Wq:()=>n,_h:()=>o,qQ:()=>u,ri:()=>s,wR:()=>l,xw:()=>c});var r=a(52643);async function o(e){let{email:t,password:a}=e,{data:o,error:n}=await r.ND.auth.signInWithPassword({email:t,password:a});return{user:(null==o?void 0:o.user)||null,session:(null==o?void 0:o.session)||null,error:n}}async function n(e){let{email:t,password:a,nome:o}=e,{data:n,error:s}=await r.ND.auth.signUp({email:t,password:a,options:{data:{nome:o}}});return{user:(null==n?void 0:n.user)||null,session:(null==n?void 0:n.session)||null,error:s}}async function s(){let{error:e}=await r.ND.auth.signOut();return!e}async function i(){let{data:{user:e}}=await r.ND.auth.getUser();return e}async function u(){let{data:{session:e}}=await r.ND.auth.getSession();return e}async function l(){return!!await u()}async function c(e){let{error:t}=await r.ND.auth.resetPasswordForEmail(e);return!t}},25731:(e,t,a)=>{"use strict";a.d(t,{Ay:()=>n,Zq:()=>o});var r=a(52643);async function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.startsWith("/api/")?e:"/api".concat(e.startsWith("/")?e:"/".concat(e)),o=new Headers(t.headers);if(o.set("Content-Type","application/json"),!1!==t.requireAuth)try{let{data:{session:e}}=await r.Ay.auth.getSession(),a=null==e?void 0:e.access_token;if(a)o.set("Authorization","Bearer ".concat(a));else if(t.requireAuth)throw Error("Autentica\xe7\xe3o necess\xe1ria para acessar este recurso")}catch(e){if(t.requireAuth)throw Error("Falha na autentica\xe7\xe3o")}let n=a;if(t.params){let e=new URLSearchParams;Object.entries(t.params).forEach(t=>{let[a,r]=t;null!=r&&e.append(a,r)});let a=e.toString();a&&(n+="?".concat(a))}try{let e=await fetch(n,{...t,headers:o});if(!e.ok){let t=await e.json().catch(()=>null),a=(null==t?void 0:t.error)||(null==t?void 0:t.message)||"Erro desconhecido";throw Error("Erro ".concat(e.status,": ").concat(a))}let a=e.headers.get("content-type");if(a&&a.includes("application/json"))return await e.json();return await e.text()}catch(e){throw console.error("Erro ao chamar API ".concat(a,":"),e),e}}let n={get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return o(e,{...t,method:"GET"})},post(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return o(e,{...a,method:"POST",body:JSON.stringify(t)})},put(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return o(e,{...a,method:"PUT",body:JSON.stringify(t)})},patch(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return o(e,{...a,method:"PATCH",body:JSON.stringify(t)})},delete(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return o(e,{...t,method:"DELETE"})}}},35695:(e,t,a)=>{"use strict";var r=a(18999);a.o(r,"usePathname")&&a.d(t,{usePathname:function(){return r.usePathname}}),a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}}),a.o(r,"useSearchParams")&&a.d(t,{useSearchParams:function(){return r.useSearchParams}})},47239:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>c});var r=a(95155),o=a(12115),n=a(35695),s=a(6874),i=a.n(s),u=a(25731),l=a(9458);function c(e){let{params:t}=e,a=(0,n.useRouter)(),s=(0,o.use)(t).id,[c,d]=(0,o.useState)(!1),[h,m]=(0,o.useState)(!0),[p,f]=(0,o.useState)(null),[b,g]=(0,o.useState)({nome:"",descricao:"",preco_unitario:"",quantidade_estoque:"",e_materia_prima:!1});(0,o.useEffect)(()=>{(async()=>{if(!await (0,l.qQ)()){console.log("Usu\xe1rio n\xe3o autenticado, redirecionando para login..."),a.push("/login");return}if(s){m(!0);try{var e,t;let a=await u.Ay.get("/api/produtos/".concat(s));if(a.error)throw Error(a.error||"Erro ao carregar produto");let r=a.data;g({nome:r.nome||"",descricao:r.descricao||"",preco_unitario:(null==(e=r.preco_unitario)?void 0:e.toString())||"",quantidade_estoque:(null==(t=r.quantidade_estoque)?void 0:t.toString())||"",e_materia_prima:r.e_materia_prima||!1})}catch(e){console.error("Erro ao carregar produto:",e),f(e instanceof Error?e.message:"Erro ao carregar produto")}finally{m(!1)}}})()},[a,s]);let x=e=>{let{name:t,value:a,type:r}=e.target;if("checkbox"===r){let a=e.target;g({...b,[t]:a.checked})}else if("preco_unitario"===t||"quantidade_estoque"===t){let e=a.replace(/[^\d.]/g,"");g({...b,[t]:e})}else g({...b,[t]:a})},y=async e=>{e.preventDefault(),d(!0),f(null);try{if(!await (0,l.qQ)())throw Error("Usu\xe1rio n\xe3o autenticado. Fa\xe7a login para continuar.");let e={...b,preco_unitario:parseFloat(b.preco_unitario)||0,quantidade_estoque:parseFloat(b.quantidade_estoque)||0},t=await u.Ay.put("/api/produtos/".concat(s),e);if(t.error)throw Error(t.error||"Erro ao atualizar produto");a.push("/produtos")}catch(e){console.error("Erro ao atualizar produto:",e),f(e instanceof Error?e.message:"Erro ao atualizar produto")}finally{d(!1)}};return h?(0,r.jsx)("div",{className:"container mx-auto p-6 flex justify-center items-center",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-600"})}):(0,r.jsxs)("div",{className:"container mx-auto p-6",suppressHydrationWarning:!0,children:[(0,r.jsxs)("div",{className:"mb-6 flex justify-between items-center",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold",children:"Editar Produto"}),(0,r.jsx)(i(),{href:"/produtos",className:"bg-gray-200 px-4 py-2 rounded hover:bg-gray-300",children:"Voltar"})]}),p&&(0,r.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:(0,r.jsx)("p",{children:p})}),(0,r.jsxs)("form",{onSubmit:y,className:"bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4",children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"nome",children:"Nome"}),(0,r.jsx)("input",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",id:"nome",type:"text",name:"nome",value:b.nome,onChange:x,required:!0})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"descricao",children:"Descri\xe7\xe3o"}),(0,r.jsx)("textarea",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",id:"descricao",name:"descricao",value:b.descricao,onChange:x,rows:3})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"preco_unitario",children:"Pre\xe7o Unit\xe1rio (R$)"}),(0,r.jsx)("input",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",id:"preco_unitario",type:"text",name:"preco_unitario",value:b.preco_unitario,onChange:x,required:!0})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"quantidade_estoque",children:"Quantidade em Estoque"}),(0,r.jsx)("input",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",id:"quantidade_estoque",type:"text",name:"quantidade_estoque",value:b.quantidade_estoque,onChange:x})]}),(0,r.jsx)("div",{className:"mb-4",children:(0,r.jsxs)("label",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"checkbox",name:"e_materia_prima",checked:b.e_materia_prima,onChange:x,className:"mr-2"}),(0,r.jsx)("span",{className:"text-gray-700 text-sm font-bold",children:"\xc9 mat\xe9ria-prima?"})]})}),(0,r.jsx)("div",{className:"flex items-center justify-between",children:(0,r.jsx)("button",{className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",type:"submit",disabled:c,children:c?"Salvando...":"Salvar Altera\xe7\xf5es"})})]})]})}},52643:(e,t,a)=>{"use strict";a.d(t,{Ay:()=>i,ND:()=>s});var r=a(10851);let o="https://delvfbrkwsuudzunzdlk.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRlbHZmYnJrd3N1dWR6dW56ZGxrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg0NjMxMzIsImV4cCI6MjA2NDAzOTEzMn0.0eq-pFMGWuDHFmzyehrYSLKDP6HY2CBDMsU3ynZpR8g";if(!o||!n)throw Error("As vari\xe1veis de ambiente NEXT_PUBLIC_SUPABASE_URL e NEXT_PUBLIC_SUPABASE_ANON_KEY precisam estar configuradas");let s=(0,r.UU)(o,n,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0,storageKey:"orcamentos-auth-token"}}),i=s},56936:(e,t,a)=>{Promise.resolve().then(a.bind(a,47239))}},e=>{var t=t=>e(e.s=t);e.O(0,[851,6874,8441,1684,7358],()=>t(56936)),_N_E=e.O()}]);