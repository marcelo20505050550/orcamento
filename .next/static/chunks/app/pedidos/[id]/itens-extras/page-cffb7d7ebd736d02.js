(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7893],{25731:(e,r,a)=>{"use strict";a.d(r,{Ay:()=>d,Zq:()=>s});var t=a(52643);async function s(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.startsWith("/api/")?e:"/api".concat(e.startsWith("/")?e:"/".concat(e)),s=new Headers(r.headers);if(s.set("Content-Type","application/json"),!1!==r.requireAuth)try{let{data:{session:e}}=await t.Ay.auth.getSession(),a=null==e?void 0:e.access_token;if(a)s.set("Authorization","Bearer ".concat(a));else if(r.requireAuth)throw Error("Autentica\xe7\xe3o necess\xe1ria para acessar este recurso")}catch(e){if(r.requireAuth)throw Error("Falha na autentica\xe7\xe3o")}let d=a;if(r.params){let e=new URLSearchParams;Object.entries(r.params).forEach(r=>{let[a,t]=r;null!=t&&e.append(a,t)});let a=e.toString();a&&(d+="?".concat(a))}try{let e=await fetch(d,{...r,headers:s});if(!e.ok){let r=await e.json().catch(()=>null),a=(null==r?void 0:r.error)||(null==r?void 0:r.message)||"Erro desconhecido";throw Error("Erro ".concat(e.status,": ").concat(a))}let a=e.headers.get("content-type");if(a&&a.includes("application/json"))return await e.json();return await e.text()}catch(e){throw console.error("Erro ao chamar API ".concat(a,":"),e),e}}let d={get(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s(e,{...r,method:"GET"})},post(e,r){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return s(e,{...a,method:"POST",body:JSON.stringify(r)})},put(e,r){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return s(e,{...a,method:"PUT",body:JSON.stringify(r)})},patch(e,r){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return s(e,{...a,method:"PATCH",body:JSON.stringify(r)})},delete(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s(e,{...r,method:"DELETE"})}}},49691:(e,r,a)=>{"use strict";a.r(r),a.d(r,{default:()=>l});var t=a(95155),s=a(12115),d=a(6874),i=a.n(d),o=a(25731);function l(e){let{params:r}=e,a=(0,s.use)(r).id,[d,l]=(0,s.useState)([]),[n,c]=(0,s.useState)(!0),[m,x]=(0,s.useState)(null),[u,h]=(0,s.useState)(!1),[g,b]=(0,s.useState)(!1),[y,p]=(0,s.useState)(null),[f,v]=(0,s.useState)({nome:"",descricao:"",valor:""}),[N,j]=(0,s.useState)(null),[k,w]=(0,s.useState)({nome:"",descricao:"",valor:""}),[E,S]=(0,s.useState)(!1),[C,I]=(0,s.useState)(null),[A,F]=(0,s.useState)(!1);(0,s.useEffect)(()=>{let e=async()=>{c(!0);try{let e=await (0,o.Zq)("/api/pedidos/".concat(a,"/itens-extras"));l(e.data)}catch(e){console.error("Erro ao buscar itens extras:",e),x(e instanceof Error?e.message:"Erro ao carregar itens extras")}finally{c(!1)}};a&&e()},[a]);let O=e=>{let{name:r,value:a}=e.target;if("valor"===r){let e=a.replace(/[^\d,\.]/g,"").split(/[,\.]/),t=e[0];e.length>1&&(t+=","+e.slice(1).join("").slice(0,2)),v({...f,[r]:t})}else v({...f,[r]:a})},D=e=>{let{name:r,value:a}=e.target;if("valor"===r){let e=a.replace(/[^\d,\.]/g,"").split(/[,\.]/),t=e[0];e.length>1&&(t+=","+e.slice(1).join("").slice(0,2)),w({...k,[r]:t})}else w({...k,[r]:a})},q=async e=>{e.preventDefault(),b(!0),p(null);try{if(!f.nome.trim())throw Error("Nome \xe9 obrigat\xf3rio");let e=parseFloat(f.valor.replace(",","."));if(!f.valor||isNaN(e)||e<=0)throw Error("Valor deve ser maior que zero");let r={nome:f.nome.trim(),descricao:f.descricao.trim()||void 0,valor:e},t=await (0,o.Zq)("/api/pedidos/".concat(a,"/itens-extras"),{method:"POST",body:JSON.stringify(r)});l([...d,t.data]),v({nome:"",descricao:"",valor:""}),h(!1)}catch(e){console.error("Erro ao adicionar item extra:",e),p(e instanceof Error?e.message:"Ocorreu um erro ao adicionar o item extra")}finally{b(!1)}},P=e=>{j(e),w({nome:e.nome,descricao:e.descricao||"",valor:e.valor.toString().replace(".",",")})},T=async e=>{if(e.preventDefault(),N){S(!0);try{if(!k.nome.trim())throw Error("Nome \xe9 obrigat\xf3rio");let e=parseFloat(k.valor.replace(",","."));if(!k.valor||isNaN(e)||e<=0)throw Error("Valor deve ser maior que zero");let r={nome:k.nome.trim(),descricao:k.descricao.trim()||void 0,valor:e},a=await (0,o.Zq)("/api/pedidos/itens-extras/".concat(N.id),{method:"PUT",body:JSON.stringify(r)});l(d.map(e=>e.id===N.id?a.data:e)),j(null)}catch(e){console.error("Erro ao editar item extra:",e),p(e instanceof Error?e.message:"Ocorreu um erro ao editar o item extra")}finally{S(!1)}}},z=e=>{I(e)},_=async()=>{if(C){F(!0);try{await (0,o.Zq)("/api/pedidos/itens-extras/".concat(C.id),{method:"DELETE"}),l(d.filter(e=>e.id!==C.id)),I(null)}catch(e){console.error("Erro ao excluir item extra:",e),x(e instanceof Error?e.message:"Ocorreu um erro ao excluir o item extra")}finally{F(!1)}}},J=e=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e),U=e=>{let r=new Date(e);return new Intl.DateTimeFormat("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(r)};return n?(0,t.jsx)("div",{className:"p-4 flex justify-center items-center h-full",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-600"})}):(0,t.jsxs)("div",{className:"p-4 space-y-6",suppressHydrationWarning:!0,children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Itens Extras do Pedido"}),(0,t.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Gerencie os itens extras deste pedido"})]}),(0,t.jsxs)("div",{className:"flex space-x-3",children:[(0,t.jsx)(i(),{href:"/pedidos/".concat(a),className:"inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700",children:"â† Voltar ao Pedido"}),(0,t.jsx)("button",{onClick:()=>h(!u),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:u?"Cancelar":"+ Adicionar Item Extra"})]})]}),m&&(0,t.jsx)("div",{className:"bg-red-50 dark:bg-red-900/30 p-4 rounded-md",children:(0,t.jsx)("p",{className:"text-red-800 dark:text-red-200",children:m})}),u&&(0,t.jsx)("div",{className:"bg-white dark:bg-gray-800 shadow rounded-lg",children:(0,t.jsxs)("div",{className:"px-4 py-5 sm:p-6",children:[(0,t.jsx)("h3",{className:"text-lg leading-6 font-medium text-gray-900 dark:text-white mb-4",children:"Adicionar Novo Item Extra"}),y&&(0,t.jsx)("div",{className:"mb-4 bg-red-50 dark:bg-red-900/30 p-4 rounded-md",children:(0,t.jsx)("p",{className:"text-red-800 dark:text-red-200",children:y})}),(0,t.jsxs)("form",{onSubmit:q,className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6",children:[(0,t.jsxs)("div",{className:"sm:col-span-4",children:[(0,t.jsx)("label",{htmlFor:"nome",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Nome do Item"}),(0,t.jsx)("div",{className:"mt-1",children:(0,t.jsx)("input",{type:"text",name:"nome",id:"nome",required:!0,value:f.nome,onChange:O,className:"shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md",placeholder:"Ex: Taxa de urg\xeancia, Material especial, etc."})})]}),(0,t.jsxs)("div",{className:"sm:col-span-2",children:[(0,t.jsx)("label",{htmlFor:"valor",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Valor (R$)"}),(0,t.jsx)("div",{className:"mt-1",children:(0,t.jsx)("input",{type:"text",name:"valor",id:"valor",required:!0,value:f.valor,onChange:O,inputMode:"decimal",pattern:"[0-9]+([,\\.][0-9]{1,2})?",className:"shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md",placeholder:"0,00"})})]}),(0,t.jsxs)("div",{className:"sm:col-span-6",children:[(0,t.jsx)("label",{htmlFor:"descricao",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Descri\xe7\xe3o (opcional)"}),(0,t.jsx)("div",{className:"mt-1",children:(0,t.jsx)("textarea",{id:"descricao",name:"descricao",rows:3,value:f.descricao,onChange:O,className:"shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md",placeholder:"Descri\xe7\xe3o detalhada do item extra"})})]})]}),(0,t.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,t.jsx)("button",{type:"button",onClick:()=>h(!1),className:"bg-white dark:bg-gray-800 py-2 px-4 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Cancelar"}),(0,t.jsx)("button",{type:"submit",disabled:g,className:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:g?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2"}),"Adicionando..."]}):"Adicionar Item Extra"})]})]})]})}),(0,t.jsx)("div",{className:"bg-white dark:bg-gray-800 shadow rounded-lg",children:(0,t.jsxs)("div",{className:"px-4 py-5 sm:p-6",children:[(0,t.jsxs)("h3",{className:"text-lg leading-6 font-medium text-gray-900 dark:text-white mb-4",children:["Itens Extras (",d.length,")"]}),0===d.length?(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:"Nenhum item extra adicionado ainda."}),!u&&(0,t.jsx)("button",{onClick:()=>h(!0),className:"mt-4 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700",children:"+ Adicionar Primeiro Item Extra"})]}):(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,t.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Nome"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Descri\xe7\xe3o"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Valor"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Data de Cria\xe7\xe3o"}),(0,t.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"A\xe7\xf5es"})]})}),(0,t.jsx)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:d.map(e=>(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:e.nome}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:e.descricao||"-"}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:J(e.valor)}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:U(e.created_at)}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,t.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,t.jsx)("button",{onClick:()=>P(e),className:"text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300",children:"Editar"}),(0,t.jsx)("button",{onClick:()=>z(e),className:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300",children:"Excluir"})]})})]},e.id))})]})})]})}),N&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-[9999]","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true",children:(0,t.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-lg w-full max-h-[90vh] overflow-y-auto",children:(0,t.jsxs)("div",{className:"px-4 py-5 sm:p-6",children:[(0,t.jsx)("h3",{className:"text-lg leading-6 font-medium text-gray-900 dark:text-white mb-4",children:"Editar Item Extra"}),(0,t.jsxs)("form",{onSubmit:T,className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6",children:[(0,t.jsxs)("div",{className:"sm:col-span-4",children:[(0,t.jsx)("label",{htmlFor:"edit-nome",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Nome do Item"}),(0,t.jsx)("div",{className:"mt-1",children:(0,t.jsx)("input",{type:"text",name:"nome",id:"edit-nome",required:!0,value:k.nome,onChange:D,className:"shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md"})})]}),(0,t.jsxs)("div",{className:"sm:col-span-2",children:[(0,t.jsx)("label",{htmlFor:"edit-valor",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Valor (R$)"}),(0,t.jsx)("div",{className:"mt-1",children:(0,t.jsx)("input",{type:"text",name:"valor",id:"edit-valor",required:!0,value:k.valor,onChange:D,inputMode:"decimal",pattern:"[0-9]+([,\\.][0-9]{1,2})?",className:"shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md"})})]}),(0,t.jsxs)("div",{className:"sm:col-span-6",children:[(0,t.jsx)("label",{htmlFor:"edit-descricao",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Descri\xe7\xe3o (opcional)"}),(0,t.jsx)("div",{className:"mt-1",children:(0,t.jsx)("textarea",{id:"edit-descricao",name:"descricao",rows:3,value:k.descricao,onChange:D,className:"shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md"})})]})]}),(0,t.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,t.jsx)("button",{type:"button",onClick:()=>{j(null),w({nome:"",descricao:"",valor:""})},className:"bg-white dark:bg-gray-800 py-2 px-4 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700",children:"Cancelar"}),(0,t.jsx)("button",{type:"submit",disabled:E,className:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-50",children:E?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2"}),"Salvando..."]}):"Salvar Altera\xe7\xf5es"})]})]})]})})}),C&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-[9999]","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true",children:(0,t.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-md w-full",children:(0,t.jsxs)("div",{className:"px-4 py-5 sm:p-6",children:[(0,t.jsx)("h3",{className:"text-lg leading-6 font-medium text-gray-900 dark:text-white mb-4",children:"Confirmar Exclus\xe3o"}),(0,t.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-6",children:['Tem certeza de que deseja excluir o item extra "',C.nome,'"? Esta a\xe7\xe3o n\xe3o pode ser desfeita.']}),(0,t.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,t.jsx)("button",{type:"button",onClick:()=>{I(null)},disabled:A,className:"bg-white dark:bg-gray-800 py-2 px-4 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50",children:"Cancelar"}),(0,t.jsx)("button",{type:"button",onClick:_,disabled:A,className:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 disabled:opacity-50",children:A?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2"}),"Excluindo..."]}):"Sim, Excluir"})]})]})})})]})}},51992:(e,r,a)=>{Promise.resolve().then(a.bind(a,49691))},52643:(e,r,a)=>{"use strict";a.d(r,{Ay:()=>o,ND:()=>i});var t=a(10851);let s="https://delvfbrkwsuudzunzdlk.supabase.co",d="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRlbHZmYnJrd3N1dWR6dW56ZGxrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg0NjMxMzIsImV4cCI6MjA2NDAzOTEzMn0.0eq-pFMGWuDHFmzyehrYSLKDP6HY2CBDMsU3ynZpR8g";if(!s||!d)throw Error("As vari\xe1veis de ambiente NEXT_PUBLIC_SUPABASE_URL e NEXT_PUBLIC_SUPABASE_ANON_KEY precisam estar configuradas");let i=(0,t.UU)(s,d,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0,storageKey:"orcamentos-auth-token"}}),o=i}},e=>{var r=r=>e(e.s=r);e.O(0,[851,6874,8441,1684,7358],()=>r(51992)),_N_E=e.O()}]);